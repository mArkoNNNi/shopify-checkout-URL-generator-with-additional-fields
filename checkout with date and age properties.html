<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Product Selection</title>
	</head>

	<body>
		<div id="url"></div>
		<div class="js-shop" data-size="small" data-type="birthday">
			<p class="js-shop__label">Is this for a birthday or other occasion?</p>
			<div class="js-shop__options">
				<div class="type type-birthday  js-multi-variant" data-type="birthday">birthday</div>
				<div class="type type-regular js-multi-variant active" data-type="regular">regular</div>
			</div>
			<p class="js-shop__label">Select the perfect size:</p>
			<div class="js-shop__options">
				<div class="btn active btn-small js-multi-variant" data-size="small">Small <span class="js-shop__price">$129</span></div>
				<div class="btn btn-medium js-multi-variant" data-size="medium">Medium <span  class="js-shop__price">$159</span></div>
				<div class="btn btn-large js-multi-variant" data-size="large">Large <span  class="js-shop__price">$239</span></div>
			</div>
			<div class="js-shop__inputs">
				<div class="js-shop__age"><label for="age">Add Recipient Age</label><input
						type="number" id="age" name="age"></div>
				<div class="js-shop__date"><label for="date">Delivery Date:
						<span id="dateDisplay" class="js-shop__date-value">09/02/2023</span></label><input
						type="date" id="date" name="DATE" min max></div>
			</div>
			<div class="js-shop__purchase">
				<div class="shop-custom-quantity">
					<button class="shop-custom-quantity__minus">-</button>
					<span class="shop-custom-quantity__value">1</span>
					<button class="shop-custom-quantity__plus">+</button>
				</div>
				<div class="js-shop__button">
					<p class="js-shop__free-shipping"><svg width="18" height="19"
							viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
							<g clip-path="url(#clip0_1810_929)">
								<path fill-rule="evenodd" clip-rule="evenodd"
									d="M12.832 4.51227C14.3926 4.8744 14.9896 5.78696 15.7381 7.04297H12.832V4.51227ZM3.71173 7.14844C4.01729 7.14844 4.23907 7.29593 4.23907 7.64062C4.23907 7.93135 4.00383 8.16714 3.71324 8.16797H0.527344C0.236069 8.16797 0 8.40417 0 8.69531C0 8.98659 0.236069 9.22266 0.527344 9.22266H5.27344C5.56746 9.22266 5.80284 9.45859 5.80284 9.75C5.80284 10.0413 5.56677 10.2773 5.2755 10.2773H0.527344C0.236069 10.2773 0 10.5134 0 10.8047C0 11.096 0.236069 11.332 0.527344 11.332H1.6875V12.9141C1.6875 13.2053 1.92357 13.4414 2.21484 13.4414H3.27489C3.46385 14.3722 4.28632 15.0586 5.25586 15.0586C6.2254 15.0586 7.04787 14.3722 7.23683 13.4414H12.5913C12.7803 14.3722 13.6027 15.0586 14.5723 15.0586C15.5418 15.0586 16.3643 14.3722 16.5532 13.4414H17.4727C17.7639 13.4414 18 13.2053 18 12.9141V9.75C18 8.20271 16.368 8.09999 16.3665 8.09766H12.3047C12.0134 8.09766 11.7773 7.86159 11.7773 7.57031V4.40625H2.21484C1.92357 4.40625 1.6875 4.64232 1.6875 4.93359V6.09375H1.05469C0.763412 6.09375 0.527344 6.32982 0.527344 6.62109C0.527344 6.91237 0.763412 7.14844 1.05469 7.14844H3.71173ZM15.2559 12.3535C15.6334 12.731 15.6334 13.3434 15.2559 13.7209C14.6486 14.3281 13.6055 13.8961 13.6055 13.0371C13.6055 12.1783 14.6486 11.7462 15.2559 12.3535ZM5.93948 12.3535C6.317 12.731 6.317 13.3434 5.93948 13.7209C5.33221 14.3281 4.28906 13.8961 4.28906 13.0371C4.28906 12.1783 5.33221 11.7462 5.93948 12.3535Z"
									fill="black" />
							</g>
							<defs>
								<clippath id="clip0_1810_929">
									<rect width="18" height="18" fill="white" transform="translate(0 0.75)" />
								</clippath>
							</defs>
						</svg>
						FREE Expedited Shipping <span>($30 Value)</span></p>
					<button class="shop-btn js-atc-button" data-product-quantity="1"
						data-product-id="44479379931369">Buy
						Now</button>
					<p class="js-shop__afterpay">from $<span class="price-afterpay">32.25</span>/mo
						with <svg width="66" height="19" viewBox="0 0 66 19" fill="none"
							xmlns="http://www.w3.org/2000/svg">
							<rect y="0.75" width="66" height="18" rx="9" fill="black" />
							<path
								d="M10.7784 10.0435C10.7784 9.14451 10.1069 8.51301 9.28177 8.51301C8.45666 8.51301 7.78513 9.15551 7.78513 10.0435C7.78513 10.921 8.45666 11.5735 9.28177 11.5735C10.1079 11.5735 10.7784 10.9425 10.7784 10.0435ZM10.7905 12.7186V12.023C10.3834 12.5045 9.77714 12.8036 9.0519 12.8036C7.54422 12.8036 6.3999 11.6265 6.3999 10.0435C6.3999 8.47051 7.58788 7.27249 9.08553 7.27249C9.79019 7.27249 10.3839 7.5725 10.791 8.0425V7.3685H12.1446V12.7186H10.7905ZM18.7184 11.5305C18.2446 11.5305 18.1131 11.3595 18.1131 10.9105V8.53501H18.9829V7.368H18.1131V6.06298H16.7258V7.368H14.9391V7.04299C14.9391 6.59299 15.1158 6.42149 15.6001 6.42149H15.9042V5.38398H15.2367C14.0924 5.38398 13.5534 5.74798 13.5534 6.86049V7.3675H12.783V8.53501H13.5534V12.7181H14.9406V8.53501H16.7274V11.1565C16.7274 12.248 17.156 12.7191 18.2782 12.7191H18.9939V11.531H18.7179L18.7184 11.5305ZM23.6926 9.56152C23.5937 8.86651 23.01 8.44901 22.328 8.44901C21.6454 8.44901 21.0843 8.85551 20.9417 9.56152H23.6921H23.6926ZM20.9302 10.3965C21.0296 11.188 21.6128 11.638 22.3501 11.638C22.9333 11.638 23.385 11.37 23.6485 10.942H25.0688C24.7381 12.076 23.6926 12.8036 22.3169 12.8036C20.6557 12.8036 19.4893 11.67 19.4893 10.054C19.4893 8.43851 20.7219 7.27199 22.3511 7.27199C23.9907 7.27199 25.1787 8.44901 25.1787 10.054C25.1787 10.172 25.1682 10.289 25.1461 10.3965H20.9302ZM33.9975 10.0435C33.9975 9.17651 33.326 8.51301 32.5008 8.51301C31.6757 8.51301 31.0042 9.15551 31.0042 10.0435C31.0042 10.921 31.6757 11.5735 32.5008 11.5735C33.326 11.5735 33.9975 10.9105 33.9975 10.0435ZM29.639 7.3685H30.9926V8.064C31.3992 7.5715 32.0045 7.27249 32.7312 7.27249C34.2168 7.27249 35.3827 8.46051 35.3827 10.0325C35.3827 11.606 34.1947 12.8046 32.6981 12.8046C32.0045 12.8046 31.4323 12.5365 31.0368 12.0875V14.9201H29.639V7.3685ZM40.2611 10.0435C40.2611 9.14451 39.5906 8.51301 38.7645 8.51301C37.9393 8.51301 37.2678 9.15551 37.2678 10.0435C37.2678 10.921 37.9393 11.5735 38.7645 11.5735C39.5906 11.5735 40.2611 10.9425 40.2611 10.0435ZM40.2731 12.7186V12.023C39.8661 12.5045 39.2598 12.8036 38.5346 12.8036C37.0269 12.8036 35.8826 11.6265 35.8826 10.0435C35.8826 8.47051 37.0706 7.27249 38.5677 7.27249C39.2719 7.27249 39.8661 7.5725 40.2731 8.0425V7.3685H41.6263V12.7186H40.2731ZM27.1998 7.893C27.1998 7.893 27.5441 7.27299 28.3878 7.27299C28.7487 7.27299 28.9821 7.393 28.9821 7.393V8.75801C28.9821 8.75801 28.4731 8.45251 28.0054 8.51401C27.5376 8.57551 27.242 8.99301 27.2435 9.55202V12.7196H25.8462V7.3695H27.1998V7.893ZM47.9471 7.3685L44.5302 14.9031H43.0893L44.4308 11.99L42.1623 7.3685H43.7954L45.1224 10.4565L46.4841 7.3685H47.9471ZM58.8547 7.24699L55.4669 5.34648C54.4732 4.78847 53.23 5.48548 53.23 6.60249V6.79749C53.23 6.97349 53.3269 7.13649 53.4835 7.22399L54.1234 7.583C54.3111 7.689 54.545 7.557 54.545 7.3465V6.86149C54.545 6.61899 54.815 6.46699 55.0308 6.58849L57.9649 8.2355C58.1807 8.35651 58.1807 8.65951 57.9649 8.78051L55.0308 10.427C54.815 10.548 54.5455 10.397 54.5455 10.154V9.89602C54.5455 8.77951 53.3023 8.081 52.307 8.64001L48.9193 10.541C48.6934 10.6646 48.505 10.8464 48.3738 11.0674C48.2426 11.2883 48.1733 11.5403 48.1733 11.797C48.1733 12.0538 48.2426 12.3058 48.3738 12.5267C48.505 12.7477 48.6934 12.9295 48.9193 13.0531L52.307 14.9536C53.3013 15.5116 54.5455 14.8146 54.5455 13.6976V13.5026C54.5449 13.4154 54.5211 13.33 54.4764 13.2551C54.4318 13.1801 54.368 13.1183 54.2915 13.0761L53.6521 12.7161C53.4644 12.6105 53.23 12.7426 53.23 12.9531V13.4381C53.23 13.6806 52.96 13.8321 52.7447 13.7106L49.8101 12.064C49.7612 12.0371 49.7203 11.9976 49.6919 11.9497C49.6635 11.9017 49.6485 11.847 49.6485 11.7913C49.6485 11.7356 49.6635 11.6809 49.6919 11.6329C49.7203 11.5849 49.7612 11.5454 49.8101 11.5185L52.7447 9.87152C52.9605 9.75002 53.23 9.90152 53.23 10.1445V10.4025C53.23 11.519 54.4727 12.2175 55.4669 11.6585L58.8547 9.75752C59.0804 9.63399 59.2686 9.45235 59.3997 9.23158C59.5307 9.01081 59.5999 8.75901 59.5999 8.50251C59.5999 8.246 59.5307 7.99421 59.3997 7.77344C59.2686 7.55267 59.0804 7.37102 58.8547 7.24749V7.24699Z"
								fill="white" />
						</svg>
					</p>
				</div>
			</div>
		</div>
		<style>
	.js-shop__options {
    display: flex;
    gap: 16px;
    align-items: center;
}

.type {
    padding: 12px;
    width: 50%;
    text-align: center;
    border: 1px solid black;
    border-radius: 10px;
    cursor: pointer;
}

.js-shop {
    max-width: 530px;
}

.btn {
    padding: 8px 12px;
    width: 33.33%;
    text-align: center;
    border: 1px solid black;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-transform: uppercase;
}

.type.active {
    background: #DEEAB0;
}

.btn.active {
    background: #DEEAB0;
}

.js-shop__purchase {
    display: flex;
    gap: 16px;
	align-items: center;
}

.shop-btn.js-atc-button {
    width: 100%;
    border: none;
    color: white;
    background: #AE2947;
    cursor: pointer;
    min-height: 48px;
}

.shop-custom-quantity {
    min-height: 48px;
}
.js-shop__inputs {
    display: flex;
    gap: 16px;
}
.js-shop__date, .js-shop__age {
    display: flex;
    flex-direction: column;
    gap: 16px;
}
.js-shop__button {
    flex: 1;
    text-align: center;
}
</style>

		<script>
		var variantID = {
			regular: {
				small: '42629054529769',
				medium: '42629055119593',
				large: '42629055447273',
			},
			birthday: {
				small: '44479379931369',
				medium: '44479379964137',
				large: '44479379996905',
			}
		}
		var prices = {
			regular: {
				small: '$129',
				medium: '$159',
				large: '$239',
			},
			birthday: {
				small: '$139',
				medium: '$169',
				large: '$249',
			}
		}
		var product = {
			id: '',
			quantity: 1,
			date: '',
			age: '',
		};

		var isVisisble = true;
		var url = 'https://boarderie.com/';
		var discount = '';
		var multiVariantParentWrapper = document.querySelector('.js-shop');
		multiVariantParentWrapper.dataset.size = 'small';
		multiVariantParentWrapper.dataset.type = 'regular';

		var multiVariantTrigger = document.querySelectorAll('.js-multi-variant');
		multiVariantTrigger.forEach(function (item) {
			item.addEventListener('click', function () {
				var dataSize = item.dataset.size;
				var dataType = item.dataset.type;
				var btn = multiVariantParentWrapper.querySelector('.js-atc-button');

				if (dataType) {
					multiVariantParentWrapper.dataset.type = dataType;
				}

				if (dataSize) {
					multiVariantParentWrapper.dataset.size = dataSize;
				}

				btn.dataset.productId = variantID[multiVariantParentWrapper.dataset.type][multiVariantParentWrapper.dataset.size];

			});
		});
		if (isVisisble) {
			document.querySelector('.type-birthday').style.display = 'block'
		}
		else {
			document.querySelector('.type-birthday').style.display = 'none'
		}
		const ageInput = document.querySelector(".js-shop__age");
		ageInput.style.display = "none";

		document.querySelector('.type-birthday').addEventListener('click', () => {
			ageInput.style.display = "flex";
		});

		document.querySelector('.type-regular').addEventListener('click', () => {
			ageInput.style.display = "none";
		});

		const datePicker = document.getElementById("date");
		const currentDate = new Date();
		const tomorrow = new Date(currentDate);
		tomorrow.setDate(currentDate.getDate() + 1);

		// Format the dates as yyyy-mm-dd
		const currentDateFormatted = currentDate.toISOString().split("T")[0];
		const tomorrowDateFormatted = tomorrow.toISOString().split("T")[0];

		// Set the min and max attributes of the date picker
		datePicker.min = tomorrowDateFormatted;

		const dateDisplay = document.getElementById("dateDisplay");

		// Function to format a date as "dd/mm/yyyy"
		function formatDate(date) {
			const day = date.getDate().toString().padStart(2, "0");
			const month = (date.getMonth() + 1).toString().padStart(2, "0");
			const year = date.getFullYear();
			return `${day}/${month}/${year}`;
		}

		// Calculate the date that is 2 days from now
		const currentDateLabel = new Date();
		const twoDaysFromNow = new Date(currentDateLabel);
		twoDaysFromNow.setDate(currentDateLabel.getDate() + 2);

		// Set the initial content of the date display span
		dateDisplay.textContent = formatDate(twoDaysFromNow);

		// Function to update the content of the date display span
		function updateDateDisplay(selectedDate) {
			const dateParts = selectedDate.split('-');
			const year = dateParts[0];
			const month = dateParts[1];
			const day = dateParts[2];
			const formattedDate = `${day}/${month}/${year}`;
			dateDisplay.textContent = formattedDate;
		}

		// Add an event listener to the date picker input element
		datePicker.addEventListener('input', function () {
			const selectedDate = this.value;
			updateDateDisplay(selectedDate);
		});
		// Function to update the product object based on the selected product ID
		function updateProduct(productId) {
			product.id = productId;
		}

		// Function to update the quantity in the product object
		function updateQuantity(quantity) {
			product.quantity = quantity;
		}

		// Function to update the age in the product object
		function updateAge(age) {
			product.age = age;
		}
		function setActiveButton(clickedButton) {
			document.querySelectorAll('.btn').forEach(button => {
				if (button === clickedButton) {
					button.classList.add('active');
				} else {
					button.classList.remove('active');
				}
			});
		}

		function setActiveButtonType(clickedButtonType) {
			document.querySelectorAll('.type').forEach(button => {
				if (button === clickedButtonType) {
					button.classList.add('active');
				} else {
					button.classList.remove('active');
				}
			});
		}

		function updatePrices(type) {
			document.querySelectorAll('.js-shop__price').forEach(function (priceElement) {
				const size = priceElement.parentElement.getAttribute('data-size');
				priceElement.textContent = prices[type][size];
			});
		}

		// Add event listeners to the regular and birthday buttons to update prices
		document.querySelector('.type-regular').addEventListener('click', () => {
			updatePrices('regular');
		});

		document.querySelector('.type-birthday').addEventListener('click', () => {
			updatePrices('birthday');
		});

		// Add event listeners to the product selection buttons
		document.querySelectorAll('.btn').forEach(button => {
			const productId = button.getAttribute('data-product-id');
			button.addEventListener('click', () => {
				updateProduct(productId);
				setActiveButton(button);
			});
		});

		document.querySelectorAll('.type').forEach(button => {
			const productId = button.getAttribute('data-product-id');
			button.addEventListener('click', () => {
				updateProduct(productId);
				setActiveButtonType(button);
			});
		});

		// Add event listeners to the quantity buttons
		document.querySelector('.shop-custom-quantity__minus').addEventListener('click', () => {
			const currentValue = parseInt(document.querySelector('.shop-custom-quantity__value').textContent, 10);
			if (currentValue > 1) {
				const newValue = currentValue - 1;
				updateQuantity(newValue);
				document.querySelector('.shop-custom-quantity__value').textContent = newValue;
			}
		});

		document.querySelector('.shop-custom-quantity__plus').addEventListener('click', () => {
			const currentValue = parseInt(document.querySelector('.shop-custom-quantity__value').textContent, 10);
			const newValue = currentValue + 1;
			updateQuantity(newValue);
			document.querySelector('.shop-custom-quantity__value').textContent = newValue;
		});

		// Add an event listener to the "Buy Now" button
		document.querySelector('.js-atc-button').addEventListener('click', (event) => {
			event.preventDefault();

			const selectedDate = document.getElementById("date").value;
			const dateParts = selectedDate.split('-');
			const formattedDate = dateParts[2] + '/' + dateParts[1] + '/' + dateParts[0];
			const ageValue = parseInt(document.getElementById("age").value);
			product.id = document.querySelector('.js-atc-button').dataset.productId;
			if (ageInput.style.display === "block" && selectedDate) {
				if (!isNaN(ageValue)) {
					product.date = formattedDate;
					product.age = ageValue;
					setTimeout(() => {
						const generatedURL = generateURL();
						if (generatedURL) {
							window.location.href = generatedURL; 
						}
					}, 100);
				}
				else {
					alert("Please enter an age.");
				}
			}
			else if (!selectedDate){
				alert("Please select a valid date");
			}
			else {
				product.date = formattedDate;
				setTimeout(() => {
					const generatedURL = generateURL();
					if (generatedURL) {
						window.location.href = generatedURL; 
					}
				}, 100);
			}
		});

		// Generate the URL based on the updated product object
		function generateURL() {
			console.log("Inside generateURL")
			var {
				id,
				quantity,
				date,
				age,
			} = product;

			if (id && date) {
				var obj = {
					id: id,
					quantity: quantity || 1,
					properties: {
						'Arrival Date': date,
					}
				}
				if (age) {
					obj.properties['Recipient Age'] = age;
				}

				var finalUrl = checkoutUrlGenerator(url, [obj], discount);
				return finalUrl
			}
		}



		// Checkout URL generator function
		function checkoutUrlGenerator(storeUrl, productsArray, discountCode) {
			if (!storeUrl || !productsArray.length) {
				console.error('Store URL or Products Array is missing in checkoutUrlGenerator function');
				return;
			}

			// Create the base URL
			var finalURL = storeUrl + '/cart/clear?return_to=';

			// Add the product information to the URL
			var sellingPlanItems = [];
			var nonSellingPlanItems = [];

			productsArray.forEach((product, i) => {
				if (!product.id) return;
				var itemId = `items[${i}][id]=${encodeURIComponent(product.id)}`;
				var itemQty = `items[${i}][quantity]=${encodeURIComponent(product.quantity || 5)}`;
				var itemSellingPlan = product.sellingPlanId
					? `items[${i}][selling_plan]=${encodeURIComponent(product.sellingPlanId)}`
					: '';

				var itemProperties = '';
				if (product.properties) {
					itemProperties = Object.entries(product.properties)
						.map(([key, value]) => `items[${i}][properties][${encodeURIComponent(`${key}`)}]=${encodeURIComponent(value)}`)
						.join('&');
				}

				if (product.sellingPlanId) {
					sellingPlanItems.push(`${itemId}&${itemSellingPlan}&${itemQty}&${itemProperties}`);
				} else {
					nonSellingPlanItems.push(`${itemId}&${itemQty}&${itemProperties}`);
				}
			});

			var items = [
				...sellingPlanItems,
				...nonSellingPlanItems
			];

			finalURL += encodeURIComponent(`/cart/add?${items.join('&')}`);

			// Add the discount code to the URL
			if (discountCode) {
				finalURL += `%26discount=${discountCode}`;
			}

			// Add the return_to parameter to the URL
			finalURL += `%26return_to%3D%2Fcheckout`;

			console.log(finalURL);
			document.getElementById('url').innerText = finalURL;
			return finalURL;
		}


	</script>
	</body>

</html>